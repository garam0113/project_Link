<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  						
<mapper namespace="FeedMapper">



	<resultMap	id="feedSelectMap"			type="feed">
		<result property="feedNo"			column="feed_no"					jdbcType="NUMERIC" />
		<result property="userId"			column="user_id"					jdbcType="VARCHAR" />
		<result property="openCondition"	column="feed_open_condition"		jdbcType="VARCHAR" />
		<result property="content"			column="feed_content"				jdbcType="VARCHAR" />
		<result property="image1"			column="feed_image1"				jdbcType="VARCHAR" />
		<result property="image2"			column="feed_image2"				jdbcType="VARCHAR" />
		<result property="image3"			column="feed_image3"				jdbcType="VARCHAR" />
		<result property="image4"			column="feed_image4"				jdbcType="VARCHAR" />
		<result property="video"			column="feed_video"					jdbcType="VARCHAR" />
		<result property="hashtag"			column="hashtag"					jdbcType="VARCHAR" />
		<result property="heartCount"		column="feed_heart_count"			jdbcType="NUMERIC" />
		<result property="commentCount"		column="feed_comment_count"			jdbcType="NUMERIC" />
		<result property="regDate"			column="feed_reg_date"				jdbcType="DATE" />
		<result property="updateDate"		column="feed_update_date"			jdbcType="DATE" />
		<result property="reportCondition"	column="report_condition"			jdbcType="VARCHAR" />
		<result property="deleteCondition"	column="delete_condition"			jdbcType="VARCHAR" />
	</resultMap>
	
	<resultMap id="feedCommentSelectMap" 		type="comment">
		<result property="feedCommentNo"		column="feed_comment_no"			jdbcType="NUMERIC" />
		<result property="feedNo"				column="feed_no"					jdbcType="NUMERIC" />
		<result property="commentContent"		column="feed_comment_content"		jdbcType="VARCHAR" />
		<result property="commentHeartCount"	column="feed_comment_heart_count"	jdbcType="NUMERIC" />
		<result property="commentCount"			column="feed_comment_count"			jdbcType="NUMERIC" />
		<result property="commentRegDate"		column="feed_comment_reg_date"		jdbcType="DATE" />
		<result property="commentUpdateDate"	column="feed_comment_update_date"	jdbcType="DATE" />
		<result property="reportCondition"		column="report_condition"			jdbcType="VARCHAR" />
		<result property="deleteCondition"		column="delete_condition"			jdbcType="VARCHAR" />
		<result property="parent"				column="parent"						jdbcType="NUMERIC" />
		<result property="depth"				column="depth"						jdbcType="NUMERIC" />
		<result property="sequence"				column="sequence"					jdbcType="NUMERIC" />
			
		<association property="user"			javaType="user">
			<result property="userId" 			column="user_id"		 			jdbcType="VARCHAR" />
		</association>
	
	</resultMap>



	<!--====================Feed====================-->
	<!--====================Feed====================-->
	<!--====================Feed====================-->



	<insert 	id="addFeed"					parameterType="feed">
		INSERT INTO feed
		VALUES (
			seq_feed_no.nextval,
			#{userId:VARCHAR},
			#{openCondition:VARCHAR},
			#{content:VARCHAR},
			#{image1:VARCHAR},
			#{image2:VARCHAR},
			#{image3:VARCHAR},
			#{image4:VARCHAR},
			#{video:VARCHAR},
			#{hashtag:VARCHAR},
			0,
			0,
			SYSDATE,
			#{updateDate:DATE},
			'0',
			'0'	)
	</insert>
	
	
	
	<select 	id="getFeed"					parameterType="int"			resultMap="feedSelectMap">
		SELECT 
		feed_no,
		user_id,
		feed_open_condition,
		feed_content,
		feed_image1,
		feed_image2,
		feed_image3,
		feed_image4,
		feed_video,
		hashtag,
		feed_heart_count,
		feed_comment_count,
		feed_reg_date,
		feed_update_date,
		report_condition,
		delete_condition
		FROM feed
		WHERE feed_no = #{feed_no}
	</select>
	
	
	
	<update		id="updateFeed"					parameterType="feed">
		UPDATE feed
		<set>
			feed_open_condition				= #{openCondition:VARCHAR},
			feed_content					= #{content:VARCHAR},
			feed_image1						= #{image1:VARCHAR},
			feed_image2						= #{image2:VARCHAR},
			feed_image3						= #{image3:VARCHAR},
			feed_image4						= #{image4:VARCHAR},
			feed_video						= #{video:VARCHAR},
			hashtag							= #{hashtag:VARCHAR},
			feed_update_date				= SYSDATE,
			report_condition				= #{reportCondition}
		</set>	
		WHERE feed_no 						= #{feedNo}
	</update>
	
	
	
	<update 	id="updateFeedHeart"			parameterType="hashmap">
		UPDATE feed
		<set>
			feed_heart_count				= #{count} + 1		
		</set>
		WHERE feed_no						= #{feedNo}
	</update>
	
	
	
	<update		id="deleteFeed"					parameterType="int">
		UPDATE feed
		<set>
			delete_condition				= '1'
		</set>
		WHERE feed_no 						= #{feedNo}
	</update>
	
	
	
	<!--====================Feed Comment====================-->
	<!--====================Feed Comment====================-->
	<!--====================Feed Comment====================-->
	
	
	
	<insert 	id="addFeedComment"				parameterType="comment">
		INSERT into feed_comment
		VALUES (
			seq_feed_comment_no.nextval,
			#{feedNo:NUMERIC},
			#{user.userId:VARCHAR},
			#{commentContent:VARCHAR},
			0,
			0,
			SYSDATE,
			null,
			'0',
			'0',
			#{parent:NUMERIC},
			#{depth:NUMERIC},
			#{sequence:NUMERIC}				)
	</insert>
	
	
	
	<select 	id="getFeedComment"				parameterType="int"			resultMap="feedCommentSelectMap">
		SELECT 
		feed_comment_no,
		feed_no,
		user_id,
		feed_comment_content,
		feed_comment_heart_count,
		feed_recomment_count,
		feed_comment_reg_date,
		feed_comment_update_date,
		report_condition,
		delete_condition,
		parent,
		depth,
		sequence
		FROM feed_comment
		WHERE feed_comment_no = #{feed_comment_no}
	</select>
	
	
	
	<update 	id="updateFeedComment"			parameterType="comment">
		UPDATE feed_comment
		<set>
			feed_comment_content			= #{commentContent},
			feed_comment_update_date		= SYSDATE,
			report_condition				= #{reportCondition},
			parent							= #{parent},
			depth							= #{depth},
			sequence						= #{sequence}
		</set>
		WHERE feed_comment_no				= #{feedCommentNo}
	</update>
	
											 
	
	<update		id="deleteFeedComment"			parameterType="comment">
		UPDATE feed_comment
		<set>
			delete_condition				= '1'
		</set>
		WHERE feed_comment_no				= #{feedCommentNo}
	</update>

	
	
	<update 	id="updateFeedCommentOrder"		parameterType="int">
		UPDATE feed_comment
		<set>
			depth							= TO_NUMBER(depth) + 1
			sequence						= TO_NUMBER(sequence) + 1
		</set>
		WHERE parent						= #{parent}
	</update>
	
	
	
	<!--====================List====================-->
	<!--====================List====================-->
	<!--====================List====================-->
	
	
	
	<select 	id="getFeedList"				parameterType="search"		resultMap="feedSelectMap">
		SELECT 
		f.feed_no,
		f.user_id,
		f.feed_open_condition,
		f.feed_content,
		f.feed_image1,
		f.feed_image2,
		f.feed_image3,
		f.feed_image4,
		f.feed_video,
		f.hashtag,
		f.feed_heart_count,
		f.feed_comment_count,
		f.feed_reg_date,
		f.feed_update_date,
		f.report_condition,
		f.delete_condition
		FROM feed f
		<if test="searchKeyword != ''">
			<where>
				f.feed_content LIKE '%${searchKeyword}%'
			</where>
		</if>
		ORDER BY feed_no DESC
	</select>
	
	
	
	<select 	id="getFeedCommentList"			parameterType="hashmap"		resultMap="feedCommentSelectMap">
		SELECT 
		feed_comment_no,
		feed_no,
		user_id,
		feed_comment_content,
		feed_comment_heart_count,
		feed_recomment_count,
		feed_comment_reg_date,
		feed_comment_update_date,
		report_condition,
		delete_condition,
		parent,
		depth,
		sequence
		FROM feed_comment
		WHERE feed_no						= #{feedNo}
		AND report_condition				= '0'
		AND delete_condition				= '0'
		ORDER BY feed_comment_no ASC
	</select>
	
	
	
	<select 	id="getMyFeedList"				parameterType="hashmap"		resultMap="feedSelectMap">
		SELECT 
		f.feed_no,
		f.user_id,
		f.feed_open_condition,
		f.feed_content,
		f.feed_image1,
		f.feed_image2,
		f.feed_image3,
		f.feed_image4,
		f.feed_video,
		f.hashtag,
		f.feed_heart_count,
		f.feed_comment_count,
		f.feed_reg_date,
		f.feed_update_date,
		f.report_condition,
		f.delete_condition
		FROM feed f
		WHERE user_id =						= #{userId}		
		ORDER BY feed_no DESC
	</select>
	
	
	
	<!--====================Count====================-->
	<!--====================Count====================-->
	<!--====================Count====================-->
	
	
	
	<select 	id="getTotalFeedCount"			parameterType="search"		resultType="int">
		SELECT
	  	COUNT(*)
	  	FROM (
	  			SELECT 
	  			feed_no,
				user_id,
				feed_open_condition,
				feed_content,
				feed_image1,
				feed_image2,
				feed_image3,
				feed_image4,
				feed_video,
				hashtag,
				feed_heart_count,
				feed_comment_count,
				feed_reg_date,
				feed_update_date,
				report_condition,
				delete_condition
				FROM feed			)
	</select>
	
	
	
	<select 	id="getTotalFeedCommentCount"	parameterType="hashmap"		resultType="int">
		SELECT
	  	COUNT(*)
	  	FROM (
	  			SELECT 
	  			feed_comment_no,
				feed_no,
				user_id,
				feed_comment_content,
				feed_comment_heart_count,
				feed_recomment_count,
				feed_comment_reg_date,
				feed_comment_update_date,
				report_condition,
				delete_condition,
				parent,
				depth,
				sequence
				FROM feed_comment
				WHERE feed_no				= #{feedNo}
				ORDER BY feed_comment_no ASC	)
	</select>
	
	
	
	<select 	id="getRecommentCount"		parameterType="hashmap"		resultType="int">
		SELECT
		COUNT(*)
		FROM(
				feed_comment_no,
				feed_no,
				user_id,
				feed_comment_content,
				feed_comment_heart_count,
				feed_recomment_count,
				feed_comment_reg_date,
				feed_comment_update_date,
				report_condition,
				delete_condition,
				parent,
				depth,
				sequence
				FROM feed_comment
				WHERE feed_no 				= #{comment.feedNo}
				AND parent					= #{comment.parent}
				ORDER BY feed_comment_no ASC	)
	
	</select>
	
	
	
	<!--====================Report====================-->
	<!--====================Report====================-->
	<!--====================Report====================-->
	
	
	
	<insert id="addFeedReport"					parameterType="hashmap">
		INSERT 
		INTO report_push (
							title,
							content,
							report_source,
							feed_no,
							user_id1,
							user_id2,
							type,
							report_reason			) 
		VALUES (
			#{title},
			#{content},
			'4',
			#{userId},
			#{userId2},
			'1',
			#{report_reason}						)
	</insert>
	
	
	
	<insert id="addFeedCommentReport"			parameterType="hashmap">
		INSERT 
		INTO report_push (
							title,
							content,
							report_source,
							feed_comment_no,
							user_id1,
							user_id2,
							type,
							report_reason			) 
		VALUES (
			#{title},
			#{content},
			'5',
			#{userId},
			#{userId2},
			'1',
			#{report_reason}						)
	</insert>
	
	
	
	<!--====================Push====================-->
	<!--====================Push====================-->
	<!--====================Push====================-->
	
	
	<insert id="addFeedPush"					parameterType="hashmap">
		INSERT 
		INTO report_push (
							title,
							content,
							report_source,
							feed_no,
							user_id1,
							type			) 
		VALUES (
			#{title},
			#{content},
			'4',
			#{userId},
			'2'								)
	</insert>
	
	
	
	<insert id="addFeedCommentPush"				parameterType="hashmap">
		INSERT 
		INTO report_push (
							title,
							content,
							report_source,
							feed_comment_no,
							user_id1,
							type			) 
		VALUES (
			#{title},
			#{content},
			'5',
			#{userId},
			'2'								)
	</insert>
	
	
	
</mapper>